<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="ReportList-Mapper">

	<sql id="search">
		<if test="searchType == 'mem'.toString()">
			and ind_id like '%'||#{keyword}||'%'
		</if>
		<if test="searchType == 'co'.toString()">
			and co_name like '%'||#{keyword}||'%'
		</if>		
	</sql>

	<select id="selectAllReportList" resultType="reportList">
		/*selectAllReportList*/
		select *
	  	  from (      
			 select rownum as rnum,SearchAllReport.*
		   	   from (
				   	 select *
				   	   from false_report F
				    natural join report_list R
				      where fal_no is not null
				     <include refid="search" />
				      order by fal_no desc
				    ) SearchAllReport
		     <![CDATA[
		    where rownum <= #{endRow}
		    ]]>
		  )
		  <![CDATA[
	 	 where rnum >= #{startRow}		
		 ]]>
	</select>
	
	
	<select id="selectSearchReportListCount" resultType="int">
		/*selectSearchReportListCount*/
		select count(*)
		  from 
		       (select *
				  from false_report F
			   natural join report_list R)
		 where fal_no is not null
		 <include refid="search" />
		 order by fal_no desc   
	</select>
	
	
	<select id="selectReportListByFalNo" parameterType="int" resultType="reportList">
		/*selectReportListByFalNo*/
		select *
		  from 
		       (select *
				  from false_report F
			   natural join report_list R)
	   	 where fal_no=#{falNo}		  
	</select>
	
	<select id="selectCoDetail" parameterType="str" resultType="coDetailList">
		/*ReportList-Mapper.selectCoDetail*/
		SELECT '공채' AS TYPE
             , A.CO_ID
		     , A.CO_ADDR
		     , A.CO_DEADDR
		     , A.CO_NM AS CO_NAME
		     , A.CO_CONFIRM
		     , B.REC_WANTEDTITLE AS OPEN_TITLE
		  FROM CO_MEMBER A	/*기업회원*/
		     , RECRUIT B		/*공개채용*/
		 WHERE A.CO_NM=B.CO_NAME
	 	   AND A.CO_NM = #{coName}
          
         UNION ALL
        
         SELECT '일반' AS TYPE
              , A.CO_ID
		      , A.CO_ADDR
		      , A.CO_DEADDR
		      , A.CO_NM AS CO_NAME
		      , A.CO_CONFIRM
		      , C.OPEN_TITLE
		  FROM CO_MEMBER A	/*기업회원*/
		     , OPEN_REC C	/*일반채용*/
		 WHERE A.CO_NM=C.OPEN_CONM
	 	   AND A.CO_NM = #{coName}
	</select>
	
	<update id="updateReportChangeStatus" parameterType="reportList">
		/*ReportList-Mapper.updateReportChangeStatus*/
		UPDATE REPORT_LIST
		   SET REP_STATUS = #{repStatus}
		 WHERE FAL_NO = #{falNo}  
	</update>
	
</mapper>
